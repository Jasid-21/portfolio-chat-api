(function(){"use strict";var e={6909:function(e,o,t){var n=t(9242),s=t(3396);function r(e,o,t,n,r,a){const l=(0,s.up)("router-view");return(0,s.wg)(),(0,s.j4)(l)}var a={setup(){return{}}},l=t(89);const i=(0,l.Z)(a,[["render",r]]);var u=i,c=t(2483);const m={class:"masterContainer"},d={class:"home"};function _(e,o,t,n,r,a){const l=(0,s.up)("Navbar"),i=(0,s.up)("Rooms"),u=(0,s.up)("ChatBox"),c=(0,s.up)("ConnectedUsers");return(0,s.wg)(),(0,s.iD)("div",m,[(0,s.Wm)(l),(0,s._)("div",d,[(0,s.Wm)(i),(0,s.Wm)(u),(0,s.Wm)(c,{clients:n.clients},null,8,["clients"])])])}const p=e=>((0,s.dD)("data-v-07f34312"),e=e(),(0,s.Cn)(),e),g=p((()=>(0,s._)("h1",{class:"logo"},"Chat App",-1))),v=p((()=>(0,s._)("h3",null,"Logout",-1))),f=p((()=>(0,s._)("h3",null,"Login",-1)));function w(e,o,t,n,r,a){const l=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("nav",null,[(0,s.Wm)(l,{to:"/"},{default:(0,s.w5)((()=>[g])),_:1}),n.logged?((0,s.wg)(),(0,s.j4)(l,{key:0,to:"/login",onClick:n.logout},{default:(0,s.w5)((()=>[v])),_:1},8,["onClick"])):((0,s.wg)(),(0,s.j4)(l,{key:1,to:"/login"},{default:(0,s.w5)((()=>[f])),_:1}))])}var b=t(4870),h={name:"Navbar",setup(){const e=(0,b.iH)(!1),o=localStorage.getItem("MSG_jwt_token"),t=()=>{const e=`/logout?token=${o}`;fetch(e,{method:"POST"}).then((e=>{200==e.status&&(localStorage.removeItem("MSG_user_id"),localStorage.removeItem("MSG_token"),localStorage.removeItem("MSG_username"))}))};return o&&(e.value=!0),{logged:e,logout:t}}};const y=(0,l.Z)(h,[["render",w],["__scopeId","data-v-07f34312"]]);var k=y,S=t(7139);const I={class:"rooms"},M=["onClick"];function C(e,o,t,n,r,a){return(0,s.wg)(),(0,s.iD)("div",I,[(0,s._)("ul",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(n.rooms,((e,o)=>((0,s.wg)(),(0,s.iD)("li",{key:o,onClick:o=>n.setCurrent(e.Id),class:(0,S.C_)({current:n.current.Id==e.Id})},(0,S.zw)(e.name),11,M)))),128))])])}var x=t(65),D={name:"Rooms",setup(){const e=(0,x.oR)(),o=(0,s.Fl)((()=>e.state.rooms)),t=(0,s.Fl)((()=>e.state.currentRoom)),n=o=>{e.commit("set_current_room",o)};return{setCurrent:n,current:t,rooms:o}}};const U=(0,l.Z)(D,[["render",C],["__scopeId","data-v-598e97e9"]]);var R=U;const j=e=>((0,s.dD)("data-v-60529f41"),e=e(),(0,s.Cn)(),e),T=j((()=>(0,s._)("label",{class:"room_name-label",for:"room_name"}," Type a name for the new room: ",-1))),O=j((()=>(0,s._)("br",null,null,-1))),H={class:"buttons-container"},G={class:"users"};function F(e,o,t,r,a,l){const i=(0,s.up)("ActiveUser");return(0,s.wg)(),(0,s.iD)(s.HY,null,[r.active_container?((0,s.wg)(),(0,s.iD)("div",{key:0,class:"new_room_modal-container",onClick:o[4]||(o[4]=(...e)=>r.hideModal&&r.hideModal(...e))},[(0,s._)("div",{class:(0,S.C_)(["new_room_modal",{active:r.active_modal}]),onClick:o[3]||(o[3]=(0,n.iM)((()=>{}),["stop"]))},[T,(0,s.wy)((0,s._)("input",{class:"room_name-input",type:"text",name:"room_name",placeholder:"Eg. Testing room","onUpdate:modelValue":o[0]||(o[0]=e=>r.new_room_name=e)},null,512),[[n.nr,r.new_room_name]]),O,(0,s._)("div",H,[(0,s._)("button",{class:"confirm",onClick:o[1]||(o[1]=(...e)=>r.createNewRoom&&r.createNewRoom(...e))},"Confirm"),(0,s._)("button",{class:"cancel",onClick:o[2]||(o[2]=(...e)=>r.hideModal&&r.hideModal(...e))},"Cancel")])],2)])):(0,s.kq)("",!0),(0,s._)("div",G,[(0,s._)("ul",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.clients,((e,t)=>((0,s.wg)(),(0,s.j4)(i,{key:t,client:e,onNewRoom:o[5]||(o[5]=e=>r.openModal(e))},null,8,["client"])))),128))])])],64)}const P={key:0,class:"me"};function V(e,o,t,n,r,a){return(0,s.wg)(),(0,s.iD)("li",{class:"user_container",onDblclick:o[0]||(o[0]=(...e)=>n.new_room&&n.new_room(...e))},[t.client.Id==n.user_id?((0,s.wg)(),(0,s.iD)("span",P,(0,S.zw)("Me: "))):(0,s.kq)("",!0),(0,s._)("span",null,(0,S.zw)(t.client.username),1)],32)}var Z={name:"ActiveUser",props:["client"],emits:["newRoom"],setup(e,{emit:o}){const t=localStorage.getItem("MSG_user_id"),n=()=>{o("newRoom",e.client.Id)};return{new_room:n,user_id:t}}};const B=(0,l.Z)(Z,[["render",V],["__scopeId","data-v-f5b902cc"]]);var E=B,z=t(2492),A=t.n(z),N={name:"ConnectedUsers",components:{ActiveUser:E},setup(){const e=(0,x.oR)(),o=(0,s.Fl)((()=>e.state.io)),t=(0,s.Fl)((()=>e.state.clients)),n=localStorage.getItem("MSG_user_id"),r=(0,b.iH)(!1),a=(0,b.iH)(!1),l=(0,b.iH)("");var i=-1;const u=e=>{i=e,console.log(e),r.value=!0,setTimeout((()=>{a.value=!0}),50)},c=()=>{l.value="",a.value=!1,setTimeout((()=>{r.value=!1}),180)},m=()=>{if(!l.value.trim())return void A().fire({title:"App message",text:"You need to provide a name",icon:"error"});const t={name:l.value,user_ids:[i,n]};o.value.emit("new_room",t,(o=>{o?(c(),e.commit("add_room",o)):A().fire({title:"App message",text:"Error creating room. Please, try latter...",icon:"error"})}))};return{clients:t,new_room_name:l,active_container:r,active_modal:a,openModal:u,hideModal:c,createNewRoom:m}}};const Y=(0,l.Z)(N,[["render",F],["__scopeId","data-v-60529f41"]]);var L=Y;const W=e=>((0,s.dD)("data-v-17c96935"),e=e(),(0,s.Cn)(),e),q={key:0,class:"chatBox"},$={class:"messages-container"},K={ref:"bottom"},J={class:"form-container"},Q=W((()=>(0,s._)("input",{type:"submit",value:"Go!"},null,-1))),X={key:1,class:"alt_chatBox"};function ee(e,o,t,r,a,l){const i=(0,s.up)("MessageBbl");return 0!=Object.keys(r.current).length?((0,s.wg)(),(0,s.iD)("div",q,[(0,s._)("div",$,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(r.current.messages,((e,o)=>((0,s.wg)(),(0,s.j4)(i,{key:o,msg:e,currUser:r.user_id},null,8,["msg","currUser"])))),128)),(0,s._)("div",K,null,512)]),(0,s._)("div",J,[(0,s._)("form",{class:"messages-form",onSubmit:o[1]||(o[1]=(0,n.iM)(((...e)=>r.sendMessage&&r.sendMessage(...e)),["prevent"]))},[(0,s.wy)((0,s._)("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>r.message=e),placeholder:"Type something..."},null,512),[[n.nr,r.message]]),Q],32)])])):((0,s.wg)(),(0,s.iD)("div",X))}const oe={class:"details"},te={class:"sender"},ne={class:"date"},se={class:"day"},re={class:"hour"},ae={class:"message"};function le(e,o,t,n,r,a){return(0,s.wg)(),(0,s.iD)("div",{class:(0,S.C_)(["message-bbl",{owner:t.msg.user.Id==t.currUser}])},[(0,s._)("div",oe,[(0,s._)("span",te,(0,S.zw)(t.msg.user.username),1),(0,s._)("div",ne,[(0,s._)("span",se,(0,S.zw)(t.msg.send_date.split(/[ T]/)[0]+" "),1),(0,s._)("span",re,(0,S.zw)(t.msg.send_date.split(/[ T.]/)[1]),1)])]),(0,s._)("div",ae,(0,S.zw)(t.msg.message),1)],2)}var ie={name:"MessageBbl",props:["msg","currUser"],setup(e){const o=(0,s.Fl)((()=>e.msg)),t=new Date(o.value.send_date),n=t.getDay(),r=t.getMonth()+1,a=t.getFullYear(),l=n+"-"+r+"-"+a;return{date:l}}};const ue=(0,l.Z)(ie,[["render",le],["__scopeId","data-v-97fd2014"]]);var ce=ue,me={name:"ChatBox",components:{MessageBbl:ce},setup(){const e=(0,x.oR)(),o=(0,s.Fl)((()=>e.state.io)),t=(0,s.Fl)((()=>e.state.currentRoom)),n=(0,b.iH)(""),r=(0,b.iH)(null),a=localStorage.getItem("MSG_user_id");localStorage.getItem("MSG_username");const l=()=>{const e={sender_id:a,room_id:t.value.Id,message:n.value};console.log(e),o.value.emit("new_message",e),n.value=""};return(0,s.YP)(t,(async()=>{await(0,s.Y3)(),r.value.scrollIntoView({alignToTop:!1})}),{deep:!0}),{message:n,sendMessage:l,current:t,bottom:r,user_id:a}}};const de=(0,l.Z)(me,[["render",ee],["__scopeId","data-v-17c96935"]]);var _e=de,pe=t(2066),ge={name:"Home",components:{Navbar:k,Rooms:R,ConnectedUsers:L,ChatBox:_e},setup(){const e=(0,x.oR)(),o=(e.state.base_url,e.state.base_ws_url,(0,s.Fl)((()=>e.state.rooms))),t=(0,s.Fl)((()=>e.state.clients)),n=localStorage.getItem("MSG_jwt_token");return(0,s.bv)((async()=>{const o=(0,pe.io)({extraHeaders:{authorization:n}});o.on("connect",(()=>{console.log(o.id),o.emit("get_rooms",(t=>{console.log(t),t.error?A().fire({title:"Error message",text:t.message,icon:"error"}):(e.commit("set_rooms",t),e.commit("set_socket",o))}))})),o.on("set_online_clients",(o=>{console.log(o),o&&e.commit("set_clients",o)})),o.on("new_message",(o=>{console.log(o),o&&e.dispatch("add_message",o)}))})),{rooms:o,clients:t}}};const ve=(0,l.Z)(ge,[["render",_],["__scopeId","data-v-ee5bc3c4"]]);var fe=ve;const we=e=>((0,s.dD)("data-v-4488c8a3"),e=e(),(0,s.Cn)(),e),be={class:"masterContainer"},he=we((()=>(0,s._)("h2",null,"Login Form",-1))),ye=we((()=>(0,s._)("label",{for:"user"},"Username:",-1))),ke=we((()=>(0,s._)("br",null,null,-1))),Se=we((()=>(0,s._)("label",{for:"pass"},"Password:",-1))),Ie=we((()=>(0,s._)("br",null,null,-1))),Me=we((()=>(0,s._)("input",{type:"submit",value:"Login!"},null,-1))),Ce=we((()=>(0,s._)("br",null,null,-1)));function xe(e,o,t,r,a,l){const i=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("div",be,[(0,s._)("form",{class:"loginForm",onSubmit:o[2]||(o[2]=(0,n.iM)(((...e)=>r.submit&&r.submit(...e)),["prevent"]))},[he,ye,(0,s.wy)((0,s._)("input",{type:"text",name:"user",placeholder:"Ex: sefirot123","onUpdate:modelValue":o[0]||(o[0]=e=>r.user=e)},null,512),[[n.nr,r.user]]),ke,Se,(0,s.wy)((0,s._)("input",{type:"password",name:"pass","onUpdate:modelValue":o[1]||(o[1]=e=>r.pass=e)},null,512),[[n.nr,r.pass]]),Ie,Me,Ce,(0,s._)("span",null,[(0,s.Uk)(" Do not have an account? "),(0,s.Wm)(i,{to:"/register"},{default:(0,s.w5)((()=>[(0,s.Uk)("Signup!!")])),_:1})])],32)])}var De={name:"LoginView",setup(){const e=(0,x.oR)(),o=(0,c.tv)(),t=e.state.base_url,n=(0,b.iH)(""),s=(0,b.iH)(""),r=async()=>{const e=`${t}/auth/login`,r={username:n.value,password:s.value},a=await fetch(e,{method:"POST",body:JSON.stringify(r),headers:{"Content-Type":"application/json"}});console.log(a.status);const l=a.ok;if(console.log(l),!l)return void A().fire({title:"Error message",text:a.statusText,icon:"error"});const i=await a.json();console.log(i),localStorage.setItem("MSG_jwt_token","Bearer "+i.token),localStorage.setItem("MSG_username",n.value),localStorage.setItem("MSG_user_id",i.Id),o.replace("/")};return{user:n,pass:s,submit:r}}};const Ue=(0,l.Z)(De,[["render",xe],["__scopeId","data-v-4488c8a3"]]);var Re=Ue;const je=e=>((0,s.dD)("data-v-47a90480"),e=e(),(0,s.Cn)(),e),Te={class:"masterContainer"},Oe=je((()=>(0,s._)("h2",null,"Register Form",-1))),He=je((()=>(0,s._)("label",{for:"user"},"Username:",-1))),Ge=je((()=>(0,s._)("br",null,null,-1))),Fe=je((()=>(0,s._)("label",{for:"pass"},"Password:",-1))),Pe=je((()=>(0,s._)("br",null,null,-1))),Ve=je((()=>(0,s._)("label",{for:"conf"},"Confirm password:",-1))),Ze=je((()=>(0,s._)("br",null,null,-1))),Be=je((()=>(0,s._)("input",{type:"submit",value:"Register!"},null,-1))),Ee=je((()=>(0,s._)("br",null,null,-1)));function ze(e,o,t,r,a,l){const i=(0,s.up)("router-link");return(0,s.wg)(),(0,s.iD)("div",Te,[(0,s._)("form",{class:"loginForm",onSubmit:o[3]||(o[3]=(0,n.iM)(((...e)=>r.submit&&r.submit(...e)),["prevent"]))},[Oe,He,(0,s.wy)((0,s._)("input",{type:"text",name:"user",placeholder:"Ex: sefirot123","onUpdate:modelValue":o[0]||(o[0]=e=>r.user=e),required:""},null,512),[[n.nr,r.user]]),Ge,Fe,(0,s.wy)((0,s._)("input",{type:"password",name:"pass","onUpdate:modelValue":o[1]||(o[1]=e=>r.pass=e),required:""},null,512),[[n.nr,r.pass]]),Pe,Ve,(0,s.wy)((0,s._)("input",{type:"password",name:"conf","onUpdate:modelValue":o[2]||(o[2]=e=>r.conf=e),required:""},null,512),[[n.nr,r.conf]]),Ze,Be,Ee,(0,s._)("span",null,[(0,s.Uk)(" Alredy have an account? "),(0,s.Wm)(i,{to:"/login"},{default:(0,s.w5)((()=>[(0,s.Uk)("Login!!")])),_:1})])],32)])}var Ae={name:"LoginView",setup(){const e=(0,x.oR)(),o=(0,c.tv)(),t=e.state.base_url,n=(0,b.iH)(""),s=(0,b.iH)(""),r=(0,b.iH)(""),a=async()=>{if(s.value!=r.value)return void A().fire({title:"App message",text:"Pasword and confirmation must match!",icon:"info"});const e=`${t}/register?username=${n.value}&password=${s.value}`,a=await fetch(e,{method:"POST"}),l=a.ok;if(!l)return void A().fire({title:"Error message",text:a.statusText,icon:"error"});const i=await a.json();localStorage.setItem("MSG_token",i.token),localStorage.setItem("MSG_user_id",i.user_id),localStorage.setItem("MSG_username",n.value),o.replace("/")};return{user:n,pass:s,conf:r,submit:a}}};const Ne=(0,l.Z)(Ae,[["render",ze],["__scopeId","data-v-47a90480"]]);var Ye=Ne;const Le=[{path:"/",name:"home",component:fe},{path:"/login",name:"login",component:Re},{path:"/register",name:"register",component:Ye}],We=(0,c.p7)({history:(0,c.PO)(),routes:Le});var qe=We,$e=(t(7658),(0,x.MT)({state:{base_url:"",base_ws_url:"",io:{},rooms:[],clients:[],currentRoom:{}},mutations:{set_current_room:(e,o)=>{const t=e.rooms.find((e=>e.Id==o));t&&(console.log(t),e.currentRoom=t)},set_socket:(e,o)=>{e.io=o,console.log(e.io)},set_rooms:(e,o)=>{console.log(o);const t=o;t.forEach((e=>{e.messages=e.messages.reverse()})),e.rooms=t},add_room:(e,o)=>{e.rooms.push(o)},set_clients:(e,o)=>{e.clients=o,console.log(o)},add_client:(e,o)=>{console.log(e.clients);const t=e.clients.findIndex((e=>e.user_id==o.user_id));-1==t?e.clients.push(o):e.clients[t]=o,console.log(e.clients)},add_message:(e,o)=>{console.log(o);const t=o.room.Id,n=e.rooms.find((e=>e.Id==t));n&&(n.messages.push(o),console.log(e.currentRoom.messages))}},actions:{add_message({state:e,commit:o},t){const n=t.room.Id,s=e.rooms.find((e=>e.Id==n));if(!s){const o={...t.room,messages:[]};e.rooms.push(o)}o("add_message",t)}},modules:{}}));(0,n.ri)(u).use($e).use(qe).mount("#app")}},o={};function t(n){var s=o[n];if(void 0!==s)return s.exports;var r=o[n]={exports:{}};return e[n].call(r.exports,r,r.exports,t),r.exports}t.m=e,function(){var e=[];t.O=function(o,n,s,r){if(!n){var a=1/0;for(c=0;c<e.length;c++){n=e[c][0],s=e[c][1],r=e[c][2];for(var l=!0,i=0;i<n.length;i++)(!1&r||a>=r)&&Object.keys(t.O).every((function(e){return t.O[e](n[i])}))?n.splice(i--,1):(l=!1,r<a&&(a=r));if(l){e.splice(c--,1);var u=s();void 0!==u&&(o=u)}}return o}r=r||0;for(var c=e.length;c>0&&e[c-1][2]>r;c--)e[c]=e[c-1];e[c]=[n,s,r]}}(),function(){t.n=function(e){var o=e&&e.__esModule?function(){return e["default"]}:function(){return e};return t.d(o,{a:o}),o}}(),function(){t.d=function(e,o){for(var n in o)t.o(o,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:o[n]})}}(),function(){t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){t.o=function(e,o){return Object.prototype.hasOwnProperty.call(e,o)}}(),function(){t.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};t.O.j=function(o){return 0===e[o]};var o=function(o,n){var s,r,a=n[0],l=n[1],i=n[2],u=0;if(a.some((function(o){return 0!==e[o]}))){for(s in l)t.o(l,s)&&(t.m[s]=l[s]);if(i)var c=i(t)}for(o&&o(n);u<a.length;u++)r=a[u],t.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return t.O(c)},n=self["webpackChunkapp"]=self["webpackChunkapp"]||[];n.forEach(o.bind(null,0)),n.push=o.bind(null,n.push.bind(n))}();var n=t.O(void 0,[998],(function(){return t(6909)}));n=t.O(n)})();
//# sourceMappingURL=app.06a44898.js.map